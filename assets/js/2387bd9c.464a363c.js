"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[407],{8699:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"Getting-Started/create-a-test","title":"Create a Test","description":"Step 1: Create the tests file in the Custom folder","source":"@site/docs/Getting-Started/create-a-test.md","sourceDirName":"Getting-Started","slug":"/Getting-Started/create-a-test","permalink":"/Custom-Maester-Tests/docs/Getting-Started/create-a-test","draft":false,"unlisted":false,"editUrl":"https://github.com/DevClate/Custom-Maester-Tests/edit/main/website/docs/Getting-Started/create-a-test.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Getting Started","permalink":"/Custom-Maester-Tests/docs/category/getting-started"},"next":{"title":"Add Tests","permalink":"/Custom-Maester-Tests/docs/Getting-Started/add-multiple-tests"}}');var r=s(4848),i=s(8453);const a={sidebar_position:1},o="Create a Test",l={},c=[{value:"Step 1: Create the tests file in the <code>Custom</code> folder",id:"step-1-create-the-tests-file-in-the-custom-folder",level:3},{value:"Test-ContosoUsersMissingManagers.Tests.ps1",id:"test-contosousersmissingmanagerstestsps1",level:4},{value:"Step 2: Create test functions file",id:"step-2-create-test-functions-file",level:3},{value:"Test-ContosoUsersMissingManagers.ps1",id:"test-contosousersmissingmanagersps1",level:4},{value:"Step 3: Create the markdown file",id:"step-3-create-the-markdown-file",level:3},{value:"Test-ContosoUsersMissingManagers.md",id:"test-contosousersmissingmanagersmd",level:4},{value:"Step 4: Run the test",id:"step-4-run-the-test",level:3},{value:"Step 5: Customize to your company",id:"step-5-customize-to-your-company",level:3}];function u(e){const t={code:"code",h1:"h1",h3:"h3",h4:"h4",header:"header",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"create-a-test",children:"Create a Test"})}),"\n",(0,r.jsxs)(t.h3,{id:"step-1-create-the-tests-file-in-the-custom-folder",children:["Step 1: Create the tests file in the ",(0,r.jsx)(t.code,{children:"Custom"})," folder"]}),"\n",(0,r.jsxs)(t.p,{children:["Create a new file in the ",(0,r.jsx)(t.code,{children:"Custom"})," folder with the ",(0,r.jsx)(t.code,{children:".Tests.ps1"})," suffix."]}),"\n",(0,r.jsx)(t.h4,{id:"test-contosousersmissingmanagerstestsps1",children:"Test-ContosoUsersMissingManagers.Tests.ps1"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-powershell",children:'BeforeAll {\n.$PSScriptRoot/Test-ContosoUsersMissingManagers.ps1\n}\nDescribe "Contoso" -Tag "ENTRA.UA.1001", "Entra", "CustomTests", "Users" {\n    It "ENTRA.UA.1001: Manager Attribute - All users should have a manager attribute set" {\n\t$result = Test-ContosoUsersMissingManagers\n\t$result| Should -Be $true-Because "All users should have a manager assigned."\n    }\n}\n'})}),"\n",(0,r.jsx)(t.h3,{id:"step-2-create-test-functions-file",children:"Step 2: Create test functions file"}),"\n",(0,r.jsxs)(t.p,{children:["Create the test file in the ",(0,r.jsx)(t.code,{children:"Custom"})," folder that was referred to in the ",(0,r.jsx)(t.code,{children:"BeforeAll"})," block in the previous step."]}),"\n",(0,r.jsx)(t.h4,{id:"test-contosousersmissingmanagersps1",children:"Test-ContosoUsersMissingManagers.ps1"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-powershell",children:'function Test-ContosoUsersMissingManagers {\n\t$result = $true\n\n\ttry {\n\t   # Retrieve all users from Microsoft Graph\n\t   $users = Invoke-MtGraphRequest -RelativeUri "users" -Filter "userType eq \'Member\'"\n\n\t   # Initialize an array to track users without a manager\n\t   $usersWithoutManager = @()\n\n\t   # Loop through each user and ensure they have a manager assigned\n\t   foreach ($user in $users) {\n\t\tif ($user.jobTitle -eq "CEO" -or $user.displayName -eq "On-Premises Directory Synchronization Service Account"){\n\t\tcontinue\n}\n\n\t\t# Fetch the manager for the current user\n\t\t$manager = Get-MgUserManager -UserId $user.Id -ErrorAction SilentlyContinue\n\n\t\tif ([string]::IsNullOrEmpty($manager)) {\n\t\t   $result = $false\n\t\t   $usersWithoutManager += $user\n\t\t}\n\t   }\n\n\t   if ($result) {\n\t\t$TestResults = "Well done! There were no users with out managers assigned."\n\t   } else {\n\t\t$TestResults += "No managers are assigned for the following users.`n%TestResult%"\n\t   }\n\n\t   Add-MtTestResultDetail -Result $TestResults -GraphObjects $usersWithoutManager -GraphObjectType Users\n\t} catch {\n\t   $result = $false\n\t   Write-Error $_.Exception.Message\n\t}\n\n\treturn $result\n}\n'})}),"\n",(0,r.jsx)(t.h3,{id:"step-3-create-the-markdown-file",children:"Step 3: Create the markdown file"}),"\n",(0,r.jsxs)(t.p,{children:["Create a markdown file in the ",(0,r.jsx)(t.code,{children:"Custom"})," folder ",(0,r.jsx)(t.strong,{children:"with the same name as the test file"})," but with the ",(0,r.jsx)(t.code,{children:".md"})," extension."]}),"\n",(0,r.jsx)(t.h4,{id:"test-contosousersmissingmanagersmd",children:"Test-ContosoUsersMissingManagers.md"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-md",children:"This test checks if there are any users without a manager assigned.\n\nContoso's company policy requires that all users have a manager assigned to them. This is important for accountability and delegation of responsibilities.\n\n**To remediate this issue:**\n\n- Identify the users without a manager.\n- Raise a ticket in Service Now using [Form: Manager Missing - HR Ticket](https://contoso.service-now.com/managermissing) to request the manager assignment for the users identified in this test.\n- \ud83d\udd3a If this is not actioned in three days, escalate to the HR manager.\n\n**Learn more:**\n\n-[Manager Missing - HR Ticket](https://contoso.service-now.com/managermissing)\n-[HR Escalation Process](https://contoso.service-now.com/hrescalation)\n\n\x3c!--- Results ---\x3e\n\n%TestResult%\n\n"})}),"\n",(0,r.jsx)(t.h3,{id:"step-4-run-the-test",children:"Step 4: Run the test"}),"\n",(0,r.jsx)(t.p,{children:"Now when you run your custom tests folder this test should show"}),"\n",(0,r.jsx)(t.h3,{id:"step-5-customize-to-your-company",children:"Step 5: Customize to your company"}),"\n",(0,r.jsx)(t.p,{children:'For all 3 files, run the Find and replace for "Contoso" with your company name.'})]})}function d(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},8453:(e,t,s)=>{s.d(t,{R:()=>a,x:()=>o});var n=s(6540);const r={},i=n.createContext(r);function a(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);